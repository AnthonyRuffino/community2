{"filter":false,"title":"trello-oauth.js","tooltip":"/auth/trello-oauth.js","undoManager":{"mark":31,"position":31,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":54,"column":78},"action":"insert","lines":["http = require('http')","OAuth = require('oauth').OAuth","url = require('url')","","#run locally on a port that probably isn't taken","domain = \"127.0.0.1\"","port = 6080","","requestURL = \"https://trello.com/1/OAuthGetRequestToken\"","accessURL = \"https://trello.com/1/OAuthGetAccessToken\"","authorizeURL = \"https://trello.com/1/OAuthAuthorizeToken\"","appName = \"Trello OAuth Example\"","","#replace these with your application key/secret","key = \"YOURKEY\"","secret = \"YOURSECRET\"","","#Trello redirects the user here after authentication","loginCallback = \"http://#{domain}:#{port}/cb\"","","#need to store token: tokenSecret pairs; in a real application, this should be more permanent (redis would be a good choice)","oauth_secrets = {}","","oauth = new OAuth(requestURL, accessURL, key, secret, \"1.0\", loginCallback, \"HMAC-SHA1\")","","login = (req, res) ->","  oauth.getOAuthRequestToken (error, token, tokenSecret, results) =>","    oauth_secrets[token] = tokenSecret","    res.writeHead(302, { 'Location': \"#{authorizeURL}?oauth_token=#{token}&name=#{appName}\" })","    res.end()","","cb = (req, res) ->","  query = url.parse(req.url, true).query","","  token = query.oauth_token","  tokenSecret = oauth_secrets[token]","  verifier = query.oauth_verifier","","  oauth.getOAuthAccessToken token, tokenSecret, verifier, (error, accessToken, accessTokenSecret, results) ->","    #in a real app, the accessToken and accessTokenSecret should be stored","    oauth.getProtectedResource(\"https://api.trello.com/1/members/me\", \"GET\", accessToken, accessTokenSecret, (error, data, response) ->","      #respond with data to show that we now have access to your data","      res.end(data)","    )","","http.createServer( (req, res) ->","  if /^\\/login/.test(req.url)","    login(req, res)","  else if /^\\/cb/.test(req.url)","    cb(req, res)","  else","    res.end(\"Don't know about that\")",").listen(port, domain)","","console.log \"Server running at #{domain}:#{port}; hit #{domain}:#{port}/login\""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":4,"column":1},"action":"remove","lines":["#"]},{"start":{"row":4,"column":0},"end":{"row":4,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":1},"end":{"row":4,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":0},"end":{"row":13,"column":1},"action":"remove","lines":["#"]},{"start":{"row":13,"column":0},"end":{"row":13,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":1},"end":{"row":13,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":17,"column":1},"action":"remove","lines":["#"]},{"start":{"row":17,"column":0},"end":{"row":17,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":1},"end":{"row":17,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":0},"end":{"row":20,"column":1},"action":"remove","lines":["#"]},{"start":{"row":20,"column":0},"end":{"row":20,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":1},"end":{"row":20,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":4},"end":{"row":39,"column":5},"action":"remove","lines":["#"]},{"start":{"row":39,"column":4},"end":{"row":39,"column":5},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":5},"end":{"row":39,"column":6},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":22},"end":{"row":0,"column":23},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":30},"end":{"row":1,"column":31},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":20},"end":{"row":2,"column":21},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":20},"end":{"row":5,"column":21},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":11},"end":{"row":6,"column":12},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":56},"end":{"row":8,"column":57},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":54},"end":{"row":9,"column":55},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":57},"end":{"row":10,"column":58},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":32},"end":{"row":11,"column":33},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":15},"end":{"row":14,"column":16},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":21},"end":{"row":15,"column":22},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":45},"end":{"row":18,"column":46},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":18},"end":{"row":21,"column":19},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":88},"end":{"row":23,"column":89},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":13},"end":{"row":29,"column":14},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":32,"column":40},"end":{"row":32,"column":41},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":27},"end":{"row":34,"column":28},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":36},"end":{"row":35,"column":37},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":0},"end":{"row":37,"column":1},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":33},"end":{"row":36,"column":34},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":0},"end":{"row":37,"column":1},"action":"remove","lines":[";"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":37,"column":0},"end":{"row":37,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1422764180392,"hash":"d6aaaebc0b380ddef703d6e30ff82f2de4e2f12f"}